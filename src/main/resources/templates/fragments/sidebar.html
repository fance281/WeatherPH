<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>

<aside class="sidebar" th:fragment="sidebar">
    <div class="brand">
        <div class="brand-info">
            <span class="logo">☁️</span>
            <span class="brand-name">WeatherPH</span>
        </div>
        <button id="sidebarToggle" class="sidebar-toggle" title="Toggle Sidebar">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevrons-left"><polyline points="11 17 6 12 11 7"></polyline><polyline points="18 17 13 12 18 7"></polyline></svg>
        </button>
    </div>

    <!-- Authenticated View -->
    <div sec:authorize="isAuthenticated()" class="sidebar-content">
        <div class="user-profile">
            <div class="user-avatar" th:text="${userInitial}">U</div>
            <div class="user-details">
                <span class="user-name" th:text="${userFullName}">User Name</span>
                <!-- This form will now be submitted by JavaScript -->
                <form id="logout-form" th:action="@{/logout}" method="post" style="display: none;"></form>
                <!-- This button will trigger the modal -->
                <button type="button" class="logout-btn-sidebar" id="logout-button">Logout</button>
            </div>
        </div>

        <nav class="main-nav">
            <a th:href="@{/}" class="nav-item" th:classappend="${currentPage == 'home' ? 'active' : ''}">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                <span>Home</span>
            </a>
            <a th:href="@{/advisories}" class="nav-item" th:classappend="${currentPage == 'advisories' ? 'active' : ''}">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-triangle"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                <span>Advisories</span>
            </a>
            <a th:href="@{/about}" class="nav-item" th:classappend="${currentPage == 'about' ? 'active' : ''}">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                <span>About</span>
            </a>
        </nav>
    </div>

    <!-- Unauthenticated View -->
    <div class="unauthenticated-view-sidebar sidebar-content" sec:authorize="!isAuthenticated()">
        <a th:href="@{/login}" class="nav-item">Login</a>
        <a th:href="@{/register}" class="nav-item">Register</a>
    </div>
</aside>

<!-- Logout Confirmation Modal -->
<div id="logout-modal" class="modal-overlay" th:fragment="logout-modal">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h2>Confirm Logout</h2>
            <span class="close-button" id="logout-cancel-close">&times;</span>
        </div>
        <div class="modal-body" style="text-align: center;">
            <p>Are you sure you want to log out?</p>
            <div class="modal-actions">
                <button id="logout-cancel-btn" class="btn btn-secondary">Cancel</button>
                <button id="logout-confirm-btn" class="btn btn-danger">Logout</button>
            </div>
        </div>
    </div>
</div>

</body>
</html>
