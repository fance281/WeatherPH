<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>

<!--
Fragment Definition: sidebar
- Includes the main sidebar structure.
- Adapts to a collapsible top-bar menu on smaller screens.
- Conditionally displays user info/nav for authenticated users or login/register links.
-->
<aside class="sidebar" th:fragment="sidebar">
    <!-- Brand and Toggles -->
    <div class="brand">
        <!-- Brand Logo and Name -->
        <div class="brand-info">
            <span class="logo">☁️</span>
            <span class="brand-name">WeatherPH</span>
        </div>
        <!-- Desktop Sidebar Toggle -->
        <button id="sidebarToggle" class="sidebar-toggle desktop-toggle" title="Toggle Sidebar">
            <svg class="icon-open" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
            <svg class="icon-collapsed" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
        </button>
        <!-- Mobile Nav Toggle (Hamburger) -->
        <button id="mobileNavToggle" class="sidebar-toggle mobile-toggle" title="Toggle Navigation">
            <svg class="icon-open" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
            <svg class="icon-collapsed" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg> <!-- X icon -->
        </button>
    </div>

    <!-- Collapsible content area for both desktop sidebar and mobile dropdown -->
    <div class="sidebar-content-wrapper">
        <!-- Authenticated User Content -->
        <div sec:authorize="isAuthenticated()" class="sidebar-content authenticated">
            <div class="user-profile">
                <div class="user-avatar" th:text="${userInitial}">U</div>
                <div class="user-details">
                    <span class="user-name" th:text="${userFullName}">User Name</span>
                    <form id="logout-form" th:action="@{/logout}" method="post" style="display: none;"></form>
                    <button type="button" class="logout-btn-sidebar" id="logout-button">Logout</button>
                </div>
            </div>

            <nav class="main-nav">
                <a th:href="@{/}" class="nav-item" th:classappend="${currentPage == 'home' ? 'active' : ''}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    <span>Home</span>
                </a>
                <a th:href="@{/route-advisory}" class="nav-item" th:classappend="${currentPage == 'route-advisory' ? 'active' : ''}">
                   <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></svg>
                   <span>Route Advisory</span>
                </a>
                <a th:href="@{/advisories}" class="nav-item" th:classappend="${currentPage == 'advisories' ? 'active' : ''}">
                   <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                   <span>Advisories</span>
                </a>
                <a th:href="@{/about}" class="nav-item" th:classappend="${currentPage == 'about' ? 'active' : ''}">
                   <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                   <span>About</span>
                </a>
            </nav>
        </div>

        <!-- Unauthenticated User Content -->
        <div class="sidebar-content unauthenticated" sec:authorize="!isAuthenticated()">
             <nav class="main-nav">
                <a th:href="@{/login}" class="nav-item">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg>
                     <span>Login</span>
                 </a>
                <a th:href="@{/register}" class="nav-item">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><line x1="19" y1="8" x2="19" y2="14"></line><line x1="22" y1="11" x2="16" y2="11"></line></svg>
                     <span>Register</span>
                 </a>
             </nav>
        </div>
    </div> <!-- End sidebar-content-wrapper -->

</aside>

<!-- Logout Confirmation Modal (No changes needed here) -->
<div id="logout-modal" class="modal-overlay" th:fragment="logout-modal">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h2>Confirm Logout</h2>
            <span class="close-button" id="logout-cancel-close">&times;</span>
        </div>
        <div class="modal-body" style="text-align: center;">
            <p>Are you sure you want to log out?</p>
            <div class="modal-actions">
                <button id="logout-cancel-btn" class="btn btn-secondary">Cancel</button>
                <button id="logout-confirm-btn" class="btn btn-danger">Logout</button>
            </div>
        </div>
    </div>
</div>

</body>
</html>
