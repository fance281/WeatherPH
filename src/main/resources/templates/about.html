<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WeatherPH - About</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link th:href="@{/assets/css/styles.css}" rel="stylesheet" />
  <style>
    /* Additional styles for the weather widget on this page */
    #about-current-weather-card {
        background: linear-gradient(145deg, var(--card), var(--bg-alt));
        text-align: center;
    }
    #about-current-weather {
        padding: 15px;
        color: var(--text);
    }
    .mw-header { font-size: 16px; color: var(--muted); margin-bottom: 15px; }
    .mw-header span { font-weight: 600; color: var(--text); }
    .mw-icon { font-size: 48px; }
    .mw-temp { font-size: 42px; font-weight: 700; }
    .mw-feels { font-size: 14px; color: var(--muted); align-self: flex-end; padding-bottom: 8px; }
    .mw-pill { margin-bottom: 15px; text-transform: capitalize; }
    .mw-row {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        padding: 10px 0;
        border-top: 1px solid var(--border-color);
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 10px;
    }
    .mw-row small { font-size: 12px; color: var(--muted); }
    .mw-sun { display: flex; justify-content: space-around; font-size: 14px; }
    
    .card-body ul {
        list-style-type: none;
        padding-left: 0;
    }
    .card-body li {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin-bottom: 12px;
        color: var(--muted);
    }
    .card-body li .icon {
        flex-shrink: 0;
        margin-top: 3px;
        color: var(--accent);
    }

  </style>
</head>
<body class="dashboard-body">

<div class="dashboard-container">
    <!-- Sidebar Fragment -->
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>

    <main class="main-content">
        <section class="advisory-header">
            <h1>About WeatherPH</h1>
            <p>
                <strong>WeatherPH</strong> is a travel safety tool designed for Filipinos. Our mission is to provide clear, route-based weather and hazard advisories to help you plan safer journeys across the country, whether you're commuting daily, going on a road trip, or managing logistics.
            </p>
        </section>

        <section class="results" style="padding-top:0;">
            <div class="cards" style="grid-template-columns: 1fr 1fr;">
                <div class="card" id="about-current-weather-card">
                    <div class="card-header">
                        <h3>Your Current Local Weather</h3>
                    </div>
                    <div id="about-current-weather">
                        <p>Loading your local weather...</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Our Mission</h3>
                    </div>
                    <div class="card-body">
                       <ul>
                            <li>
                                <span class="icon">üéØ</span>
                                <span><strong>Hyper-Local Focus:</strong> Provide weather data that is relevant not just to a city, but to your specific travel route.</span>
                            </li>
                             <li>
                                <span class="icon">üõ°Ô∏è</span>
                                <span><strong>Safety First:</strong> Translate complex weather data into simple, actionable safety tips for commuters and travelers.</span>
                            </li>
                             <li>
                                <span class="icon">üáµüá≠</span>
                                <span><strong>Built for the Philippines:</strong> Tailor advisories to the unique challenges of Philippine weather and road conditions.</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Technology Stack</h3>
                    </div>
                    <div class="card-body">
                        <ul>
                            <li><span class="icon">üåê</span><span><strong>OpenWeatherMap API:</strong> For real-time global weather data.</span></li>
                            <li><span class="icon">üó∫Ô∏è</span><span><strong>Mapbox:</strong> For interactive maps and powerful geocoding services.</span></li>
                            <li><span class="icon">‚òï</span><span><strong>Java & Spring Boot:</strong> For a robust and scalable backend.</span></li>
                            <li><span class="icon">üçÉ</span><span><strong>Thymeleaf & JavaScript:</strong> For a dynamic and responsive frontend experience.</span></li>
                        </ul>
                    </div>
                </div>

                 <div class="card">
                    <div class="card-header">
                        <h3>Meet the Developer</h3>
                    </div>
                    <div class="card-body">
                        <p>This application was developed by a passionate programmer dedicated to using technology to solve real-world problems. WeatherPH was born from the desire to make travel safer and more predictable for everyone in the Philippines.</p>
                        <p>Connect and see more projects on <a href="https://github.com" target="_blank" style="color: var(--accent);">GitHub</a>.</p>
                    </div>
                </div>
            </div>
            <div class="alert alert-warning" style="margin:20px 0 0;">
              <b>Disclaimer:</b> This tool is a supportive aid, not a replacement for official government guidance. For any severe weather event or disaster, always follow instructions from PAGASA, PHIVOLCS, NDRRMC, LTO, and your local LGU.
            </div>
        </section>
    </main>
</div>

<!-- Logout Modal Fragment -->
<div th:replace="~{fragments/sidebar :: logout-modal}"></div>

<script th:src="@{/assets/js/app.js}"></script>
<script th:inline="javascript">
/*<![CDATA[*/
    document.addEventListener('DOMContentLoaded', () => {
        const localWeatherUrl = /*[[@{/api/localweather}]]*/ '/api/localweather';
        const MAPBOX_TOKEN = 'pk.eyJ1IjoibGFuY2UyMiIsImEiOiJjbWdrOTVvcjAwcnpyMmtxeTRlN2piaWx4In0.PqGLzIZ6SFCSQaBv2a7_JQ';
        const weatherWidget = document.getElementById('about-current-weather');

        // Helper functions
        function getWeatherIcon(iconCode) {
          const icons = {
            "01d": "‚òÄÔ∏è", "01n": "üåô", "02d": "üå§Ô∏è", "02n": "üå§Ô∏è", "03d": "‚õÖ",  "03n": "‚õÖ",
            "04d": "‚òÅÔ∏è", "04n": "‚òÅÔ∏è", "09d": "üåßÔ∏è", "09n": "üåßÔ∏è", "10d": "üå¶Ô∏è", "10n": "üå¶Ô∏è",
            "11d": "‚ö°",  "11n": "‚ö°", "13d": "‚ùÑÔ∏è", "13n": "‚ùÑÔ∏è", "50d": "üå´Ô∏è", "50n": "üå´Ô∏è"
          };
          return icons[iconCode] || "üå°Ô∏è";
        }

        function formatTime(unix, offset) {
          if (!unix) return '--:--';
          const date = new Date((unix + (offset || 0)) * 1000);
          let hour = date.getUTCHours(), min = date.getUTCMinutes();
          const ampm = hour >= 12 ? 'PM' : 'AM';
          hour = hour % 12; if (hour === 0) hour = 12;
          return `${hour}:${min.toString().padStart(2,'0')} ${ampm}`;
        }

        // Main display function
        function displayWeatherWidget(data, addr) {
            if (!weatherWidget) return;
            const main = data.main || {},
                  weather = (Array.isArray(data.weather) && data.weather[0]) ? data.weather[0] : {},
                  wind = data.wind || {}, sys = data.sys || {},
                  temp = main.temp != null ? Math.round(main.temp) : '--',
                  feels = main.feels_like != null ? Math.round(main.feels_like) : null,
                  desc = weather.description ? weather.description.charAt(0).toUpperCase() + weather.description.slice(1) : '',
                  icon = getWeatherIcon(weather.icon),
                  humidity = main.humidity || '--',
                  windSpd = wind.speed != null ? (wind.speed * 3.6).toFixed(1) : '--',
                  vis = data.visibility != null ? (data.visibility/1000).toFixed(1)+' km' : 'N/A',
                  sunrise = formatTime(sys.sunrise, data.timezone), 
                  sunset = formatTime(sys.sunset, data.timezone);

            weatherWidget.innerHTML = `
              <div class="mw-header">üìç <span>${addr || "Your location"}</span></div>
              <div style="display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:3px;">
                <span class="mw-icon">${icon}</span>
                <span class="mw-temp">${temp}¬∞C</span>
                ${feels ? `<span class="mw-feels">(feels like ${feels}¬∞C)</span>` : ''}
              </div>
              <div class="mw-pill" style="display:inline-block; background:rgba(33,158,188,0.18); border:1px solid rgba(33,158,188,0.35); color:#bfe7f4; border-radius:999px; padding:5px 14px 5px 14px; font-size:13px; font-weight:600; margin-bottom:15px;">
                  ${desc}
              </div>
              <div class="mw-row">
                <div><small>Humidity</small><br><b>${humidity}${humidity!=='--'?'%':''}</b></div>
                <div><small>Wind</small><br><b>${windSpd}${windSpd!=='--'?' km/h':''}</b></div>
                <div><small>Visibility</small><br><b>${vis}</b></div>
              </div>
              <div class="mw-sun">
                <span>üåÖ ${sunrise}</span>
                <span>üåá ${sunset}</span>
              </div>
            `;
        }

        // Function to fetch weather for given coordinates
        function fetchWeatherForCoords(latitude, longitude) {
            if (!weatherWidget) return;
            
            fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${longitude},${latitude}.json?access_token=${MAPBOX_TOKEN}`)
                .then(response => response.json())
                .then(geoData => {
                    const placeName = (geoData.features && geoData.features.length > 0)
                        ? geoData.features[0].place_name
                        : 'Unknown Location';

                    fetch(`${window.location.origin}${localWeatherUrl}?lat=${latitude}&lon=${longitude}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(weatherData => {
                            if (weatherData.error) {
                                weatherWidget.innerHTML = `<p>${weatherData.error}</p>`;
                                return;
                            }
                            displayWeatherWidget(weatherData, placeName);
                        })
                        .catch(error => {
                            console.error('Error fetching weather data:', error);
                            weatherWidget.innerHTML = '<p>Could not load weather data.</p>';
                        });
                })
                .catch(error => {
                    console.error('Error fetching location name:', error);
                    fetch(`${window.location.origin}${localWeatherUrl}?lat=${latitude}&lon=${longitude}`)
                        .then(res => res.json()).then(data => displayWeatherWidget(data, "Current Location"));
                });
        }
        
        // Main function to get user location
        function getUserLocation() {
            if (!weatherWidget) return;
            if (navigator.geolocation) {
                weatherWidget.innerHTML = 'Detecting your current weather...';
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        fetchWeatherForCoords(latitude, longitude);
                    },
                    () => {
                        weatherWidget.innerHTML = '<p>Location access denied. Showing weather for Manila.</p>';
                        const fallbackLat = 14.5995;
                        const fallbackLon = 120.9842;
                        fetchWeatherForCoords(fallbackLat, fallbackLon);
                    }
                );
            } else {
                weatherWidget.innerHTML = '<p>Geolocation is not supported. Showing weather for Manila.</p>';
                const fallbackLat = 14.5995;
                const fallbackLon = 120.9842;
                fetchWeatherForCoords(fallbackLat, fallbackLon);
            }
        }
        
        getUserLocation();
    });
/*]]>*/
</script>
</body>
</html>

